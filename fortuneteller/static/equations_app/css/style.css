/* --- ðŸŽ¨ Maxwell App + p5.js - style.css (Corrected v4 - Layout/Sticky Fix) ðŸŽ¨ --- */

/* ---  Variables & Base Setup --- */
:root {
    /* Light Theme (Default) */
    --bg-color: #f8f9fa; --card-bg-color: #ffffff; --text-color: #202124; --text-color-light: #5f6368; --text-color-heading: #3c4043; --text-color-inverted: #ffffff;
    --primary-color: #4285F4; --primary-color-darker: #3367D6; --primary-color-rgb: 66, 133, 244; --secondary-color: #34A853; --secondary-color-rgb: 52, 168, 83;
    --border-color: #dadce0; --link-color: var(--primary-color); --button-text-color: #ffffff; --input-background: #ffffff; --input-border: #ced4da;
    --code-bg-color: #f1f3f4; --code-text-color: #202124; --animation-bg-color: #e9ecef; --shadow-color-light: rgba(0, 0, 0, 0.06); --shadow-color-medium: rgba(0, 0, 0, 0.1);
    --card-shadow: 0 2px 4px var(--shadow-color-light), 0 2px 6px var(--shadow-color-medium); --border-radius-sm: 4px; --border-radius-md: 8px; --transition-speed: 0.2s;
    --font-family-sans: 'Roboto', sans-serif; --font-family-mono: 'Source Code Pro', monospace; --column-gap: 2rem; --animation-column-width: 350px;
    --header-height: 64px; /* Adjust if your header changes */
    --nav-height: 48px;    /* Adjust if your nav changes */
    --sticky-top-offset: 2rem; /* Vertical space below nav before sticky applies */
}
[data-theme="dark"] {
    /* Dark Theme Overrides */
    --bg-color: #202124; --card-bg-color: #2d2e30; --text-color: #e8eaed; --text-color-light: #9aa0a6; --text-color-heading: #e8eaed; --text-color-inverted: #202124;
    --primary-color: #8ab4f8; --primary-color-darker: #aecbfa; --primary-color-rgb: 138, 180, 248; --secondary-color: #81c995; --secondary-color-rgb: 129, 201, 149;
    --border-color: #3c4043; --link-color: var(--primary-color); --button-text-color: #202124; --input-background: #3c4043; --input-border: #5f6368;
    --code-bg-color: #282c34; --code-text-color: #abb2bf; --animation-bg-color: #3c4043; --shadow-color-light: rgba(0, 0, 0, 0.25); --shadow-color-medium: rgba(0, 0, 0, 0.3);
}
/* Base Transitions */ body, .app-header, .app-nav, .app-footer, .content-card, .btn, input, textarea, button, pre[class*="language-"], code[class*="language-"], .interactive-derivation, .interactive-element, .output-box, .plot-box, #epsilon-point-marker, .animation-container, .feedback, .derivation-steps .step { transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease, fill var(--transition-speed) ease, opacity var(--transition-speed) ease; }
:root, [data-theme="dark"] { transition: color var(--transition-speed) ease, background-color var(--transition-speed) ease; }
/* --- Global Styles & Typography --- */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0} html{scroll-behavior:smooth;font-size:16px} body{font-family:var(--font-family-sans);line-height:1.7;color:var(--text-color);background-color:var(--bg-color);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale} h1,h2,h3,h4{line-height:1.3;margin-bottom:0.8em;margin-top:1.5em;font-weight:500;color:var(--text-color-heading)} h1{font-size:2rem;margin-top:0} h2{font-size:1.7rem;border-bottom:2px solid var(--primary-color);padding-bottom:0.3em} h3{font-size:1.3rem;color:var(--primary-color)} h4{font-size:1.1rem;color:var(--text-color-light);font-weight:500;margin-top:1.2em} h3.interactive-title,h4.python-example-title{margin-top:1.8em;font-size:1.2rem;color:var(--secondary-color);border-bottom:1px dashed var(--border-color);padding-bottom:0.4em;margin-bottom:1em} h4.python-example-title{color:color-mix(in srgb, var(--secondary-color) 80%, var(--text-color-heading)); font-size:1.1rem;} p,ul,ol,dl{margin-bottom:1.2em;max-width:75ch} ul,ol{padding-left:25px} li{margin-bottom:0.5em} a{color:var(--link-color);text-decoration:none;font-weight:500;transition:color var(--transition-speed) ease} a:hover,a:focus{color:var(--primary-color-darker);text-decoration:underline} a:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px;border-radius:var(--border-radius-sm)} strong{font-weight:700} em{font-style:italic} .text-muted{color:var(--text-color-light);font-size:0.9em} .highlight-box{background-color:var(--bg-color);padding:1em 1.5em;border:1px solid var(--border-color);border-left:4px solid var(--secondary-color);border-radius:var(--border-radius-md);margin:1.5em 0}
/* --- App Structure Layout --- */
.app-container{display:flex;flex-direction:column;min-height:100vh} .app-header{background-color:var(--card-bg-color);padding:0.8rem 2rem;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:101;box-shadow:0 2px 5px rgba(0,0,0,0.05)} .header-content{flex-grow:1} .header-logo-link{text-decoration:none} .header-logo-link:hover{text-decoration:none} .app-header h1{color:var(--primary-color);font-weight:700;margin:0;font-size:1.4rem;display:inline-block} .app-header .subtitle{color:var(--text-color-light);font-size:0.85em;margin:0.1em 0 0 0;font-weight:400} .app-nav{background-color:var(--primary-color);position:sticky;top:var(--header-height);z-index:100;box-shadow:0 2px 5px rgba(0,0,0,0.1);overflow-x:auto;white-space:nowrap;padding:0 1rem} .app-nav ul{list-style:none;display:flex;margin:0 auto;padding:0;max-width:calc(900px + var(--animation-column-width) + var(--column-gap));justify-content:center} .app-nav ul li{margin:0} .app-nav ul li a{color:var(--text-color-inverted);text-decoration:none;padding:0.7rem 1.2rem;display:block;font-size:0.9rem;font-weight:500;border-bottom:3px solid transparent;transition:background-color var(--transition-speed) ease,border-color var(--transition-speed) ease,color var(--transition-speed) ease} .app-nav ul li a:hover{background-color:rgba(255,255,255,0.1);color:#fff;border-bottom-color:rgba(255,255,255,0.5)} .app-nav ul li a.active{background-color:rgba(255,255,255,0.15);border-bottom-color:#fff;font-weight:700;color:#fff}
/* LAYOUT REVISIONS */
.page-layout{display:flex;flex-wrap:nowrap;/* Prevent wrap on large screen*/gap:var(--column-gap);padding:2rem;max-width:calc(900px + var(--animation-column-width) + var(--column-gap) + 4rem);margin:1.5rem auto;align-items:flex-start;width:100%}
.content-column{flex:1 1 auto; min-width:55%; /* Ensure content gets enough space */ max-width:900px; order:1;}
.animation-column{flex:0 0 var(--animation-column-width); order:2; position:relative;} /* No sticky here */
/* Animation WRAPPER introduced in base.html */
.animation-container-wrapper { position:relative; width:100%; min-height: 100vh; /* Give wrapper some height initially? Or calculate dynamically */ }
/* Individual Sketch Containers */
.animation-container { background-color:var(--animation-bg-color); border:1px solid var(--border-color); border-radius:var(--border-radius-md); overflow:hidden; min-height:300px; display:none; /* HIDDEN BY DEFAULT */ align-items:center; justify-content:center; box-shadow:var(--card-shadow); width:100%; margin-bottom: 0; opacity: 0; transition: opacity 0.4s ease-in-out; position: relative; /* Default for non-sticky */ }
/* Active Sketch - THIS is sticky */
.animation-container.active-sketch { display:flex; /* Make it visible */ opacity:1; position: -webkit-sticky; /* Safari */ position: sticky; top: calc(var(--header-height) + var(--nav-height) + var(--sticky-top-offset)); z-index: 5; min-height: 350px; /* Ensure active has height */ max-height: calc(100vh - var(--header-height) - var(--nav-height) - var(--sticky-top-offset) - 2rem); /* Prevent overlapping footer */ }
.app-footer{background-color:var(--card-bg-color);text-align:center;padding:1.5rem;font-size:0.9em;color:var(--text-color-light);border-top:1px solid var(--border-color);margin-top:auto}
/* --- Content Cards --- */
.content-card{background-color:var(--card-bg-color);padding:2rem 2.5rem; margin-bottom:var(--column-gap); border-radius:var(--border-radius-md);border:1px solid var(--border-color);box-shadow:var(--card-shadow);overflow:hidden; opacity:1; transform: none; /* Removed default animation hiding */ }
.content-column > .content-card:first-child{margin-top:0} .content-column > .content-card:last-child{margin-bottom:0}
/* Card Animation (re-add if needed & working) */
/* @keyframes fadeInSlideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}} */
/* .animated {animation-name: fadeInSlideUp; animation-duration: 0.6s; animation-timing-function: ease-out; animation-fill-mode: forwards; animation-play-state: paused;} */

/* --- Buttons & Theme Toggle (Unchanged) --- */
.btn{display:inline-block;font-weight:500;text-align:center;vertical-align:middle;cursor:pointer;user-select:none;border:1px solid transparent;padding:0.6rem 1.2rem;font-size:0.95rem;line-height:1.5;border-radius:var(--border-radius-md);transition:all var(--transition-speed) ease;margin:0.5rem 0.25rem 0.5rem 0} .btn:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px} .btn-primary{color:var(--button-text-color);background-color:var(--primary-color);border-color:var(--primary-color);box-shadow:0 2px 4px rgba(0,0,0,0.1)} .btn-primary:hover,.btn-primary:focus{background-color:var(--primary-color-darker);border-color:var(--primary-color-darker);color:var(--button-text-color);box-shadow:0 3px 6px rgba(0,0,0,0.15);transform:translateY(-1px)} .btn-secondary{color:var(--primary-color);background-color:transparent;border-color:var(--primary-color)} .btn-secondary:hover,.btn-secondary:focus{background-color:rgba(var(--primary-color-rgb),0.1);border-color:var(--primary-color-darker);color:var(--primary-color-darker)} .theme-toggle-btn{background:none;border:1px solid var(--border-color);border-radius:50%;cursor:pointer;padding:0;display:flex;align-items:center;justify-content:center;width:40px;height:40px;color:var(--text-color-light)} .theme-toggle-btn:hover,.theme-toggle-btn:focus{background-color:var(--bg-color);border-color:var(--primary-color);color:var(--primary-color);outline:none} .theme-toggle-btn .icon{transition:transform 0.3s ease-out} .theme-toggle-btn .icon-dark{display:none} .theme-toggle-btn .icon-light{display:block} [data-theme="dark"] .theme-toggle-btn .icon-dark{display:block} [data-theme="dark"] .theme-toggle-btn .icon-light{display:none} [data-theme="dark"] .theme-toggle-btn:hover .icon-dark,body:not([data-theme="dark"]) .theme-toggle-btn:hover .icon-light{transform:rotate(15deg)}
/* --- Equation & Code (Unchanged) --- */
.equation-box{background-color:var(--bg-color);padding:1.2rem 1.5rem;margin:1.5em 0;border:1px solid var(--border-color);border-left:5px solid var(--secondary-color);border-radius:var(--border-radius-sm); overflow-x: auto;} .equation-box p,.equation-box .equation{margin-bottom:0.8em} .equation-box p:last-child,.equation-box .equation:last-child{margin-bottom:0} .equation,.theorem-box .equation{display:block;overflow-x:auto;padding:0.5em 0;text-align:center; max-width: 100%;} .theorem-box{border:1px solid var(--border-color);border-left:5px solid var(--primary-color);background-color:var(--bg-color);padding:1.2rem 1.5rem;margin:1.5rem 0;border-radius:var(--border-radius-sm)} .theorem-box h4{margin-top:0;color:var(--primary-color);font-size:1.2em} .theorem-box .intuition{font-style:italic;color:var(--text-color-light);font-size:0.9em;margin-top:0.8em;border-top:1px dashed var(--border-color);padding-top:0.8em} .code-container{position:relative;margin:1.5em 0} pre[class*="language-"]{background:var(--code-bg-color)!important;color:var(--code-text-color)!important;padding:1.5em!important;border-radius:var(--border-radius-sm);border:1px solid var(--border-color);font-family:var(--font-family-mono);font-size:0.9em;line-height:1.6;overflow:auto;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1)} :not(pre) > code[class*="language-"]{background:var(--code-bg-color);color:var(--code-text-color);padding:.2em .4em;border-radius:var(--border-radius-sm);font-size:0.9em;font-family:var(--font-family-mono);border:1px solid var(--border-color)} div.code-toolbar{position:relative} div.code-toolbar > .toolbar{position:absolute;top:0.5em;right:0.5em;opacity:0;transition:opacity 0.2s ease-in-out;z-index:3} div.code-toolbar:hover > .toolbar{opacity:1} div.code-toolbar > .toolbar > .toolbar-item > button{background-color:var(--border-color);color:var(--text-color-light);border:none;padding:0.4em 0.8em;font-size:0.8em;border-radius:var(--border-radius-sm);cursor:pointer;transition:background-color 0.2s,color 0.2s;box-shadow:none} div.code-toolbar > .toolbar > .toolbar-item > button:hover{background-color:var(--secondary-color);color:var(--text-color-inverted)} div.code-toolbar > .toolbar > .toolbar-item > button.copied{background-color:var(--secondary-color)!important;color:var(--text-color-inverted)!important} button.copy-btn:disabled{background-color:#d32f2f!important;color:#fff!important;cursor:not-allowed}
/* --- Interactive Derivations (CSS Unchanged) --- */
.interactive-derivation{border:1px solid var(--border-color);padding:1rem 1.5rem 1.5rem 1.5rem;margin-top:1.5rem;border-radius:var(--border-radius-sm);background-color:var(--bg-color)} .interactive-derivation h4{margin-top:0;border-bottom:1px solid var(--border-color);padding-bottom:0.5rem;margin-bottom:1rem;font-size:1.1em;color:var(--text-color-heading)} .derivation-steps{margin-bottom:1rem} .derivation-steps .step{display:none; padding:1em 1.2em;margin-bottom:0.5em;border-radius:var(--border-radius-sm);background-color:var(--card-bg-color);border:1px dashed var(--border-color);font-size:0.95em;line-height:1.6;min-height:60px; opacity:1; transition: none;} .derivation-steps .step.active{display:block; animation: fadeInStep 0.3s ease-out;} @keyframes fadeInStep{from{opacity:0;}to{opacity:1;}} .derivation-steps .step strong{color:var(--primary-color);display:block;margin-bottom:0.5em;font-weight:500} .interactive-derivation .derivation-button{margin-top:0.5rem}
/* Inputs (Unchanged) */ /* ... */
/* Epsilon Explorer (Unchanged) */ /* ... */
/* Plot Box (Unchanged) */ /* ... */
/* p5 Canvas Placeholder (Unchanged) */ .animation-placeholder p,.animation-container:empty::before{content:'Visualization loading...';display:block;color:var(--text-color-light);font-style:italic;font-size:0.9em;text-align:center;padding:1rem} .animation-container>canvas{display:block;max-width:100%;height:auto} .animation-container p.error{color:#d32f2f;font-weight:500;background-color:rgba(211,47,47,0.1);padding:1rem;border:1px dashed #d32f2f;border-radius:var(--border-radius-sm)}
/* Quiz (Unchanged) */ /* ... */
/* Glossary (Unchanged) */ /* ... */
/* --- Responsive Adjustments --- */
@media(max-width:1024px){ /* Tablet and smaller */ :root{--animation-column-width:300px;--column-gap:1.5rem} .app-nav ul{max-width:calc(800px + var(--animation-column-width) + var(--column-gap))} .page-layout{padding:1.5rem;max-width:calc(800px + var(--animation-column-width) + var(--column-gap) + 3rem)} .content-card{padding:1.5rem 2rem}}
@media(max-width:992px) { /* Increased stacking breakpoint */
    .page-layout{ flex-direction: column; /* Stack */ flex-wrap: wrap; padding: 1rem; max-width: 95%; }
    .content-column{ max-width: 100%; order: 1; margin-bottom: var(--column-gap); }
    .animation-column{ flex-basis:auto; width:100%; max-width:500px; margin: 0 auto 2rem auto; order: 2; }
    .animation-container-wrapper { position: static; /* Turn off wrapper sticky */ padding-top: 0; min-height: unset; }
    .animation-container { position: relative !important; /* Override sticky attempts */ top: auto !important; display: flex !important; /* Show all when stacked? Needs review */ opacity: 1 !important; margin-bottom: var(--column-gap); }
     .animation-container:last-of-type { margin-bottom: 0; }
     .animation-container.active-sketch { /* No longer needs sticky on mobile */ position: relative !important; top: auto !important; /* Adjust if needed for alignment within column */ }
}
@media(max-width:768px){ html{font-size:15px} .app-header{padding:0.6rem 1rem;flex-wrap:wrap} .header-content{flex-basis:100%;text-align:center;margin-bottom:0.5rem} .app-header .theme-toggle-btn{margin:0 auto} .app-nav{top:100px; /* Approx height of wrapped header */ justify-content:flex-start} .app-nav ul{justify-content:flex-start} .results-container{grid-template-columns:1fr} .content-card{padding:1.2rem 1.5rem} h1{font-size:1.8rem} h2{font-size:1.5rem} h3{font-size:1.2rem}}
@media(max-width:600px){ /* Further adjustments if needed */ }
/* --- Accessibility --- */
@media(prefers-contrast:more){:root{--card-shadow:none;--border-color:var(--text-color)} [data-theme=dark]{--border-color:var(--text-color)} input,select,textarea,.content-card,.btn{border-width:2px}}
